{% extends 'base.html' %}

{% block title %}Edit Job - FindAJob.ai Admin{% endblock %}

{% block extra_css %}
<style>
    .admin-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .form-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.3);
    }

    .section-title {
        font-family: var(--font-heading);
        font-size: 1.5rem;
        margin-bottom: 24px;
        color: var(--text-main);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .full-width {
        grid-column: span 2;
    }

    .requirement-row {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 12px;
        background: rgba(255, 255, 255, 0.02);
        padding: 12px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
    }

    .remove-req {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .remove-req:hover {
        background: #ef4444;
        color: white;
    }

    .add-req-btn {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px dashed #10b981;
        padding: 12px;
        border-radius: 12px;
        width: 100%;
        cursor: pointer;
        font-weight: 600;
        margin-top: 12px;
        transition: all 0.2s;
    }

    .add-req-btn:hover {
        background: rgba(16, 185, 129, 0.2);
    }
</style>
{% endblock %}

{% block content %}
<main class="admin-container">
    <div style="margin-bottom: 32px;">
        <h1 style="font-size: 2.5rem; margin-bottom: 8px;">Edit Job Listing</h1>
        <p style="color: var(--text-muted);">Update details for <strong>{{ job.title }}</strong> at <strong>{{
                job.company }}</strong>.</p>
    </div>

    <form method="POST" class="form-card">
        {% csrf_token %}

        <div class="section-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
            </svg>
            Job Details
        </div>

        <div class="form-grid">
            <div class="form-group full-width">
                <label>Job Title</label>
                {{ job_form.title }}
            </div>
            <div class="form-group">
                <label>Category</label>
                {{ job_form.category }}
            </div>
            <div class="form-group">
                <label>Job Terms</label>
                {{ job_form.terms }}
            </div>
            <div class="form-group">
                <label>Company Name</label>
                {{ job_form.company }}
            </div>
            <div class="form-group">
                <label>Location</label>
                {{ job_form.location }}
            </div>
            <div class="form-group">
                <label>Apply URL</label>
                {{ job_form.url }}
            </div>
            <div class="form-group">
                <label>Min. Education</label>
                {{ job_form.education_level_required }}
            </div>
            <div class="form-group">
                <label>Exp. Required (Years)</label>
                {{ job_form.experience_required_years }}
            </div>
            <div class="form-group">
                <label>Employer Email</label>
                {{ job_form.employer_email }}
            </div>
            <div class="form-group">
                <label>Expiry Date</label>
                {{ job_form.expiry_date }}
            </div>
            <div class="form-group full-width">
                <label>Job Description</label>
                {{ job_form.description }}
            </div>
        </div>

        <div class="section-title" style="margin-top: 40px;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            Requirements
        </div>

        <div id="requirements-list">
            {% for req in job.requirements.all %}
            <div class="requirement-row">
                <input type="text" name="requirement_description" class="form-input" value="{{ req.description }}"
                    required>
                <div class="checkbox-group">
                    <input type="checkbox" name="requirement_mandatory" value="{{ forloop.counter0 }}"
                        id="mand_{{ forloop.counter0 }}" {% if req.is_mandatory %}checked{% endif %}>
                    <label for="mand_{{ forloop.counter0 }}">Mandatory</label>
                </div>
                <button type="button" class="remove-req" onclick="this.parentElement.remove()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            {% empty %}
            <div class="requirement-row">
                <input type="text" name="requirement_description" class="form-input"
                    placeholder="e.g. 3+ years of Python experience" required>
                <div class="checkbox-group">
                    <input type="checkbox" name="requirement_mandatory" value="0" id="mand_0" checked>
                    <label for="mand_0">Mandatory</label>
                </div>
                <button type="button" class="remove-req" onclick="this.parentElement.remove()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
            {% endfor %}
        </div>

        <button type="button" class="add-req-btn" id="add-req">
            + Add Another Requirement
        </button>

        <div style="margin-top: 48px; display: flex; gap: 16px;">
            <button type="submit" class="btn btn-primary" style="flex: 1; padding: 16px;">Update Job Listing</button>
            <a href="{% url 'job_detail' pk=job.pk %}" class="btn btn-secondary" style="padding: 16px;">Cancel</a>
        </div>
    </form>
</main>

<script>
    const addBtn = document.getElementById('add-req');
    const list = document.getElementById('requirements-list');

    // Calculate reqCount based on current requirements or default to 1
    let reqCount = {{ job.requirements.count }};
    if (reqCount === 0) reqCount = 1;

    addBtn.addEventListener('click', () => {
        const row = document.createElement('div');
        row.className = 'requirement-row';
        row.innerHTML = `
            <input type="text" name="requirement_description" class="form-input" placeholder="e.g. Fluency in English" required>
            <div class="checkbox-group">
                <input type="checkbox" name="requirement_mandatory" value="${reqCount}" id="mand_${reqCount}" checked>
                <label for="mand_${reqCount}">Mandatory</label>
            </div>
            <button type="button" class="remove-req" onclick="this.parentElement.remove()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        `;
        list.appendChild(row);
        reqCount++;
    });
</script>
{% endblock %}