{% extends 'base.html' %}

{% block title %}Post New Job - JobMatch{% endblock %}

{% block extra_css %}
<style>
    .admin-container {
        max-width: 900px;
        margin: 40px auto;
        padding: 0 20px;
    }

    .form-card {
        background: var(--bg-card);
        border: 1px solid var(--border-color);
        border-radius: 24px;
        padding: 40px;
        box-shadow: 0 20px 40px -15px rgba(0, 0, 0, 0.3);
    }

    .section-title {
        font-family: var(--font-heading);
        font-size: 1.5rem;
        margin-bottom: 24px;
        color: var(--text-main);
        display: flex;
        align-items: center;
        gap: 12px;
    }

    .form-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
    }

    .full-width {
        grid-column: span 2;
    }

    .requirement-row {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-bottom: 12px;
        background: rgba(255, 255, 255, 0.02);
        padding: 12px;
        border-radius: 12px;
        border: 1px solid var(--border-color);
    }

    .remove-req {
        background: rgba(239, 68, 68, 0.1);
        color: #ef4444;
        border: none;
        width: 36px;
        height: 36px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        transition: all 0.2s;
    }

    .remove-req:hover {
        background: #ef4444;
        color: white;
    }

    .add-req-btn {
        background: rgba(16, 185, 129, 0.1);
        color: #10b981;
        border: 1px dashed #10b981;
        padding: 12px;
        border-radius: 12px;
        width: 100%;
        cursor: pointer;
        font-weight: 600;
        margin-top: 12px;
        transition: all 0.2s;
    }

    .add-req-btn:hover {
        background: rgba(16, 185, 129, 0.2);
    }

    .hidden-field {
        display: none;
    }
</style>
{% endblock %}

{% block content %}
<main class="admin-container">
    <div style="margin-bottom: 32px;">
        <h1 style="font-size: 2.5rem; margin-bottom: 8px;">Post New Job</h1>
        <p style="color: var(--text-muted);">
            {% if role == 'Employer' %}
            Posting as <strong>{{ user.company.name }}</strong>.
            {% else %}
            Fill in the details to create a new job listing.
            {% endif %}
        </p>
    </div>

    <form method="POST" class="form-card">
        {% csrf_token %}

        {% if job_form.errors %}
        <div
            style="background: rgba(239, 68, 68, 0.1); color: #ef4444; padding: 16px; border-radius: 12px; margin-bottom: 24px; border: 1px solid rgba(239, 68, 68, 0.2);">
            <h4 style="margin-bottom: 8px;">Please correct the following errors:</h4>
            <ul style="font-size: 0.9rem; padding-left: 20px;">
                {% for field, errors in job_form.errors.items %}
                {% for error in errors %}
                <li><strong>{{ field|title }}:</strong> {{ error }}</li>
                {% endfor %}
                {% endfor %}
            </ul>
        </div>
        {% endif %}

        <div class="section-title">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <rect x="2" y="7" width="20" height="14" rx="2" ry="2"></rect>
                <path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"></path>
            </svg>
            Job Details
        </div>

        <div class="form-grid">
            <div class="form-group full-width">
                <label>Job Title</label>
                {{ job_form.title }}
            </div>

            <div class="form-group">
                <label>Category</label>
                {{ job_form.category }}
            </div>

            <div class="form-group">
                <label>Job Terms</label>
                {{ job_form.terms }}
            </div>

            {% if role == 'Admin' %}
            <div class="form-group">
                <label>Company Name (Display)</label>
                {{ job_form.company }}
            </div>
            <div class="form-group">
                <label>Company Profile</label>
                {{ job_form.company_profile }}
            </div>
            {% else %}
            <!-- For Employers, we send these hidden to pass validation if required, 
                 but the view handles auto-assignment -->
            <div class="hidden-field">
                {{ job_form.company }}
                {{ job_form.company_profile }}
            </div>
            {% endif %}

            <div class="form-group">
                <label>Location</label>
                {{ job_form.location }}
            </div>
            <div class="form-group">
                <label>Min. Education Required</label>
                {{ job_form.education_level_required }}
            </div>
            <div class="form-group">
                <label>Exp. Required (Years)</label>
                {{ job_form.experience_required_years }}
            </div>
            <div class="form-group">
                <label>Expiry Date</label>
                {{ job_form.expiry_date }}
            </div>

            <div class="section-title full-width" style="margin-top: 24px; font-size: 1.25rem;">
                Application Method
            </div>

            <div class="form-group">
                <label>Method</label>
                {{ job_form.application_method }}
            </div>
            <div class="form-group">
                <label>Employer Email (for direct apps)</label>
                {{ job_form.employer_email }}
            </div>
            <div class="form-group full-width">
                <label>Application URL (Website or Google Form)</label>
                {{ job_form.application_url }}
            </div>
            <div class="form-group full-width">
                <label>Application Instructions</label>
                {{ job_form.application_instructions }}
            </div>

            <div class="form-group full-width">
                <label>Job Description</label>
                {{ job_form.description }}
            </div>
        </div>

        <div class="section-title" style="margin-top: 40px;">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
            Key Requirements (Optional)
        </div>

        <div id="requirements-list">
            <!-- Starting with one empty row -->
            <div class="requirement-row">
                <input type="text" name="requirement_description" class="form-input"
                    placeholder="e.g. 3+ years of Python experience">
                <div class="checkbox-group" style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
                    <input type="checkbox" name="requirement_mandatory" value="0" id="mand_0" checked>
                    <label for="mand_0" style="margin-bottom: 0;">Mandatory</label>
                </div>
                <button type="button" class="remove-req" onclick="this.parentElement.remove()">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                        stroke-linecap="round" stroke-linejoin="round">
                        <line x1="18" y1="6" x2="6" y2="18"></line>
                        <line x1="6" y1="6" x2="18" y2="18"></line>
                    </svg>
                </button>
            </div>
        </div>

        <button type="button" class="add-req-btn" id="add-req">
            + Add Another Requirement
        </button>

        <div style="margin-top: 48px; display: flex; gap: 16px;">
            <button type="submit" class="btn btn-primary" style="flex: 1; padding: 16px;">Create Job Listing</button>
            <a href="{% url 'dashboard' %}" class="btn btn-secondary" style="padding: 16px;">Cancel</a>
        </div>
    </form>
</main>

<script>
    const addBtn = document.getElementById('add-req');
    const list = document.getElementById('requirements-list');
    let reqCount = 1;

    addBtn.addEventListener('click', () => {
        const row = document.createElement('div');
        row.className = 'requirement-row';
        row.innerHTML = `
            <input type="text" name="requirement_description" class="form-input" placeholder="e.g. Fluency in English">
            <div class="checkbox-group" style="display: flex; align-items: center; gap: 8px; white-space: nowrap;">
                <input type="checkbox" name="requirement_mandatory" value="${reqCount}" id="mand_${reqCount}" checked>
                <label for="mand_${reqCount}" style="margin-bottom: 0;">Mandatory</label>
            </div>
            <button type="button" class="remove-req" onclick="this.parentElement.remove()">
                <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
        `;
        list.appendChild(row);
        reqCount++;
    });
</script>
{% endblock %}